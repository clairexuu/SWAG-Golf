{
  "version": 3,
  "sources": ["../../api/src/server.ts", "../../api/src/routes/generate.ts", "../../api/src/services/python-client.ts", "../../api/src/routes/styles.ts", "../../api/src/routes/feedback.ts", "../../api/src/routes/generations.ts"],
  "sourcesContent": ["// Express API server for SWAG Concept Sketch Agent\n\nimport express from 'express';\nimport cors from 'cors';\nimport path from 'path';\nimport { fileURLToPath } from 'url';\nimport generateRouter from './routes/generate.js';\nimport stylesRouter from './routes/styles.js';\nimport feedbackRouter from './routes/feedback.js';\nimport generationsRouter from './routes/generations.js';\nimport { checkPythonHealth } from './services/python-client.js';\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n\nexport interface ApiServerOptions {\n  port?: number;\n  generatedImagesPath?: string;\n  referenceImagesPath?: string;\n  frontendPath?: string;\n}\n\nexport function createApp(options: ApiServerOptions = {}) {\n  const generatedPath = options.generatedImagesPath || path.resolve(__dirname, '../../../generated_outputs');\n  const referencePath = options.referenceImagesPath || path.resolve(__dirname, '../../../rag/reference_images');\n\n  const app = express();\n\n  // Middleware\n  app.use(cors());\n  app.use(express.json());\n\n  // Serve generated images\n  app.use('/api/generated', express.static(generatedPath));\n\n  // Serve reference images\n  app.use('/api/reference-images', express.static(referencePath));\n\n  // Request logging\n  app.use((req, res, next) => {\n    console.log(`${new Date().toISOString()} - ${req.method} ${req.path}`);\n    next();\n  });\n\n  // Health check with Python backend status\n  app.get('/api/health', async (req, res) => {\n    const pythonConnected = await checkPythonHealth();\n    res.json({\n      status: 'ok',\n      pythonBackend: pythonConnected ? 'connected' : 'disconnected',\n      version: '1.0.0',\n      mode: pythonConnected ? 'production' : 'limited'\n    });\n  });\n\n  // Mount routes\n  app.use('/api', generateRouter);\n  app.use('/api', stylesRouter);\n  app.use('/api', feedbackRouter);\n  app.use('/api', generationsRouter);\n\n  // Serve frontend static files (used by Electron in production)\n  if (options.frontendPath) {\n    app.use(express.static(options.frontendPath));\n    // SPA catch-all: serve index.html for non-API routes\n    app.get('*', (req, res, next) => {\n      if (req.path.startsWith('/api')) return next();\n      res.sendFile(path.join(options.frontendPath!, 'index.html'));\n    });\n  }\n\n  // 404 handler\n  app.use((req, res) => {\n    res.status(404).json({\n      success: false,\n      error: {\n        code: 'NOT_FOUND',\n        message: `Route ${req.path} not found`\n      }\n    });\n  });\n\n  // Error handler\n  app.use((err: Error, req: express.Request, res: express.Response, next: express.NextFunction) => {\n    console.error('Server error:', err);\n    res.status(500).json({\n      success: false,\n      error: {\n        code: 'SERVER_ERROR',\n        message: 'Internal server error'\n      }\n    });\n  });\n\n  return app;\n}\n\n/**\n * Start the API server. Used by Electron main process to embed the server.\n */\nexport function startApiServer(options: ApiServerOptions = {}): Promise<import('http').Server> {\n  const port = options.port || 3001;\n  const app = createApp(options);\n\n  return new Promise((resolve) => {\n    const server = app.listen(port, async () => {\n      const pythonConnected = await checkPythonHealth();\n      console.log(`[API] Server running on http://localhost:${port}`);\n      console.log(`[API] Python backend: ${pythonConnected ? 'CONNECTED' : 'DISCONNECTED'}`);\n      resolve(server);\n    });\n  });\n}\n\n// Auto-start when run directly (e.g., npm run dev in control/api/)\nconst isDirectRun = import.meta.url === `file://${process.argv[1]}` ||\n                    process.argv[1]?.endsWith('server.ts') ||\n                    process.argv[1]?.endsWith('server.js');\n\nif (isDirectRun) {\n  const PORT = 3001;\n  startApiServer({ port: PORT }).then(() => {\n    console.log('='.repeat(60));\n    console.log('SWAG Concept Sketch Agent - API Server');\n    console.log('='.repeat(60));\n    console.log(`Available endpoints:`);\n    console.log(`  GET  http://localhost:${PORT}/api/health`);\n    console.log(`  GET  http://localhost:${PORT}/api/styles`);\n    console.log(`  POST http://localhost:${PORT}/api/generate`);\n    console.log(`  GET  http://localhost:${PORT}/api/generated/* (static images)`);\n    console.log('='.repeat(60));\n  });\n}\n", "// POST /api/generate - Generate concept sketches\n\nimport { Router } from 'express';\nimport { fetchFromPython, checkPythonHealth, PYTHON_API_URL } from '../services/python-client.js';\nimport type { GenerateRequest, GenerateResponse, RefineRequest } from '../../../shared/schema/api-contracts.js';\n\nconst router = Router();\nconst MAX_RETRIES = 2;\nconst RETRY_DELAYS = [1000, 2000]; // ms\n\nfunction delay(ms: number): Promise<void> {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n\nrouter.post('/generate', async (req, res) => {\n  // Abort Python fetch if client disconnects (user cancelled)\n  const abortController = new AbortController();\n  res.on('close', () => {\n    if (!res.writableEnded) {\n      abortController.abort();\n    }\n  });\n\n  try {\n    const { input, styleId, numImages, experimentalMode, sessionId } = req.body as GenerateRequest;\n\n    // Validate required fields\n    if (!input || !styleId) {\n      return res.status(400).json({\n        success: false,\n        error: {\n          code: 'INVALID_REQUEST',\n          message: 'Missing required fields: input and styleId are required'\n        }\n      });\n    }\n\n    // Validate input length\n    if (input.trim().length === 0) {\n      return res.status(400).json({\n        success: false,\n        error: {\n          code: 'INVALID_INPUT',\n          message: 'Input text cannot be empty'\n        }\n      });\n    }\n\n    // Retry loop: try request directly, health-check only on failure\n    for (let attempt = 0; attempt <= MAX_RETRIES; attempt++) {\n      if (abortController.signal.aborted) return;\n\n      try {\n        const response = await fetchFromPython<GenerateResponse>('/generate', {\n          method: 'POST',\n          body: JSON.stringify({ input, styleId, numImages: numImages || 4, experimentalMode, sessionId })\n        }, abortController.signal);\n        return res.json(response);\n      } catch (pythonError) {\n        if ((pythonError as Error).name === 'AbortError') {\n          console.log('Generation cancelled by client');\n          return;\n        }\n        console.error(`[Generate] Attempt ${attempt + 1} failed:`, pythonError);\n\n        // Health-check after failure for diagnostics\n        const pythonHealthy = await checkPythonHealth();\n        if (!pythonHealthy) {\n          console.warn(`[Generate] Python backend is unreachable`);\n        }\n      }\n\n      // Wait before retrying (skip delay after last attempt)\n      if (attempt < MAX_RETRIES) {\n        console.log(`[Generate] Retrying in ${RETRY_DELAYS[attempt]}ms...`);\n        await delay(RETRY_DELAYS[attempt]);\n      }\n    }\n\n    // All retries exhausted\n    return res.status(503).json({\n      success: false,\n      error: {\n        code: 'BACKEND_UNAVAILABLE',\n        message: 'Generation service temporarily unavailable. Please try again or restart the service.'\n      }\n    });\n  } catch (error) {\n    if ((error as Error).name === 'AbortError') {\n      console.log('Generation cancelled by client');\n      return;\n    }\n    console.error('Generation error:', error);\n    res.status(500).json({\n      success: false,\n      error: {\n        code: 'GENERATION_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error occurred'\n      }\n    });\n  }\n});\n\n// SSE streaming endpoint \u2014 pipes Python SSE stream directly to the frontend\nrouter.post('/generate-stream', async (req, res) => {\n  const abortController = new AbortController();\n  res.on('close', () => abortController.abort());\n\n  try {\n    const { input, styleId } = req.body;\n    if (!input || !styleId) {\n      return res.status(400).json({\n        success: false,\n        error: { code: 'INVALID_REQUEST', message: 'Missing required fields: input and styleId are required' }\n      });\n    }\n\n    res.writeHead(200, {\n      'Content-Type': 'text/event-stream',\n      'Cache-Control': 'no-cache',\n      'Connection': 'keep-alive',\n      'X-Accel-Buffering': 'no',\n    });\n\n    const pythonRes = await fetch(`${PYTHON_API_URL}/generate-stream`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify(req.body),\n      signal: abortController.signal,\n    });\n\n    if (!pythonRes.ok || !pythonRes.body) {\n      res.write(`event: error\\ndata: ${JSON.stringify({ message: 'Backend unavailable' })}\\n\\n`);\n      res.end();\n      return;\n    }\n\n    // Pipe the SSE stream directly from Python to the frontend\n    const reader = (pythonRes.body as any).getReader();\n    const decoder = new TextDecoder();\n    try {\n      while (true) {\n        const { done, value } = await reader.read();\n        if (done) break;\n        res.write(decoder.decode(value, { stream: true }));\n      }\n    } catch (err) {\n      if ((err as Error).name !== 'AbortError') {\n        res.write(`event: error\\ndata: ${JSON.stringify({ message: 'Stream interrupted' })}\\n\\n`);\n      }\n    }\n    res.end();\n  } catch (err) {\n    if ((err as Error).name === 'AbortError') return;\n    if (!res.headersSent) {\n      res.status(500).json({\n        success: false,\n        error: { code: 'STREAM_ERROR', message: err instanceof Error ? err.message : 'Unknown error' }\n      });\n    } else {\n      res.write(`event: error\\ndata: ${JSON.stringify({ message: 'Backend unavailable' })}\\n\\n`);\n      res.end();\n    }\n  }\n});\n\nrouter.post('/refine', async (req, res) => {\n  const abortController = new AbortController();\n  res.on('close', () => {\n    if (!res.writableEnded) {\n      abortController.abort();\n    }\n  });\n\n  try {\n    const { refinePrompt, selectedImagePaths, styleId, sessionId } = req.body as RefineRequest;\n\n    // Validate required fields\n    if (!refinePrompt || !selectedImagePaths?.length || !styleId) {\n      return res.status(400).json({\n        success: false,\n        error: {\n          code: 'INVALID_REQUEST',\n          message: 'Missing required fields: refinePrompt, selectedImagePaths, and styleId are required'\n        }\n      });\n    }\n\n    // Retry loop: try request directly, health-check only on failure\n    for (let attempt = 0; attempt <= MAX_RETRIES; attempt++) {\n      if (abortController.signal.aborted) return;\n\n      try {\n        const response = await fetchFromPython<GenerateResponse>('/refine', {\n          method: 'POST',\n          body: JSON.stringify({ refinePrompt, selectedImagePaths, styleId, sessionId })\n        }, abortController.signal);\n        return res.json(response);\n      } catch (pythonError) {\n        if ((pythonError as Error).name === 'AbortError') {\n          console.log('Refine cancelled by client');\n          return;\n        }\n        console.error(`[Refine] Attempt ${attempt + 1} failed:`, pythonError);\n\n        // Health-check after failure for diagnostics\n        const pythonHealthy = await checkPythonHealth();\n        if (!pythonHealthy) {\n          console.warn(`[Refine] Python backend is unreachable`);\n        }\n      }\n\n      if (attempt < MAX_RETRIES) {\n        console.log(`[Refine] Retrying in ${RETRY_DELAYS[attempt]}ms...`);\n        await delay(RETRY_DELAYS[attempt]);\n      }\n    }\n\n    // All retries exhausted\n    return res.status(503).json({\n      success: false,\n      error: {\n        code: 'BACKEND_UNAVAILABLE',\n        message: 'Generation service temporarily unavailable. Please try again or restart the service.'\n      }\n    });\n  } catch (error) {\n    if ((error as Error).name === 'AbortError') {\n      console.log('Refine cancelled by client');\n      return;\n    }\n    console.error('Refine error:', error);\n    res.status(500).json({\n      success: false,\n      error: {\n        code: 'REFINE_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error occurred'\n      }\n    });\n  }\n});\n\n// SSE streaming refine endpoint \u2014 pipes Python SSE stream directly to the frontend\nrouter.post('/refine-stream', async (req, res) => {\n  const abortController = new AbortController();\n  res.on('close', () => abortController.abort());\n\n  try {\n    const { refinePrompt, selectedImagePaths, styleId } = req.body;\n    if (!refinePrompt || !selectedImagePaths?.length || !styleId) {\n      return res.status(400).json({\n        success: false,\n        error: { code: 'INVALID_REQUEST', message: 'Missing required fields: refinePrompt, selectedImagePaths, and styleId are required' }\n      });\n    }\n\n    res.writeHead(200, {\n      'Content-Type': 'text/event-stream',\n      'Cache-Control': 'no-cache',\n      'Connection': 'keep-alive',\n      'X-Accel-Buffering': 'no',\n    });\n\n    const pythonRes = await fetch(`${PYTHON_API_URL}/refine-stream`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify(req.body),\n      signal: abortController.signal,\n    });\n\n    if (!pythonRes.ok || !pythonRes.body) {\n      res.write(`event: error\\ndata: ${JSON.stringify({ message: 'Backend unavailable' })}\\n\\n`);\n      res.end();\n      return;\n    }\n\n    // Pipe the SSE stream directly from Python to the frontend\n    const reader = (pythonRes.body as any).getReader();\n    const decoder = new TextDecoder();\n    try {\n      while (true) {\n        const { done, value } = await reader.read();\n        if (done) break;\n        res.write(decoder.decode(value, { stream: true }));\n      }\n    } catch (err) {\n      if ((err as Error).name !== 'AbortError') {\n        res.write(`event: error\\ndata: ${JSON.stringify({ message: 'Stream interrupted' })}\\n\\n`);\n      }\n    }\n    res.end();\n  } catch (err) {\n    if ((err as Error).name === 'AbortError') return;\n    if (!res.headersSent) {\n      res.status(500).json({\n        success: false,\n        error: { code: 'STREAM_ERROR', message: err instanceof Error ? err.message : 'Unknown error' }\n      });\n    } else {\n      res.write(`event: error\\ndata: ${JSON.stringify({ message: 'Backend unavailable' })}\\n\\n`);\n      res.end();\n    }\n  }\n});\n\nexport default router;\n", "// HTTP client for communicating with Python FastAPI backend\n\nexport const PYTHON_API_URL = process.env.PYTHON_API_URL || 'http://127.0.0.1:8000';\n\n/**\n * Fetch data from Python backend.\n * @param endpoint - API endpoint (e.g., '/styles', '/generate')\n * @param options - Fetch options\n * @returns Parsed JSON response\n */\nexport async function fetchFromPython<T>(\n  endpoint: string,\n  options: RequestInit = {},\n  signal?: AbortSignal\n): Promise<T> {\n  const url = `${PYTHON_API_URL}${endpoint}`;\n\n  const response = await fetch(url, {\n    ...options,\n    signal,\n    headers: {\n      'Content-Type': 'application/json',\n      ...options.headers,\n    },\n  });\n\n  if (!response.ok) {\n    const errorText = await response.text();\n    throw new Error(`Python API error (${response.status}): ${errorText}`);\n  }\n\n  return response.json();\n}\n\n/**\n * Check if Python backend is healthy and reachable.\n * @returns true if Python backend is available\n */\nexport async function checkPythonHealth(): Promise<boolean> {\n  try {\n    const response = await fetch(`${PYTHON_API_URL}/health`, {\n      method: 'GET',\n      signal: AbortSignal.timeout(2000), // 2 second timeout\n    });\n    return response.ok;\n  } catch {\n    return false;\n  }\n}\n", "// GET /api/styles - Return available style options\n\nimport { Router } from 'express';\nimport { Readable } from 'stream';\nimport type { Style } from '../../../shared/schema/style.js';\nimport { fetchFromPython, checkPythonHealth } from '../services/python-client.js';\n\nconst PYTHON_API_URL = process.env.PYTHON_API_URL || 'http://127.0.0.1:8000';\n\nconst router = Router();\nconst MAX_RETRIES = 2;\nconst RETRY_DELAYS = [1000, 2000]; // ms\n\nfunction delay(ms: number): Promise<void> {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n\nrouter.get('/styles', async (req, res) => {\n  try {\n    // Retry loop: try up to 3 times with backoff\n    for (let attempt = 0; attempt <= MAX_RETRIES; attempt++) {\n      const pythonHealthy = await checkPythonHealth();\n      if (pythonHealthy) {\n        try {\n          const response = await fetchFromPython<{ success: boolean; styles: Style[] }>('/styles');\n          return res.json(response);\n        } catch (err) {\n          console.error(`[Styles] Attempt ${attempt + 1} failed:`, err);\n        }\n      } else {\n        console.warn(`[Styles] Health check failed (attempt ${attempt + 1}/${MAX_RETRIES + 1})`);\n      }\n\n      if (attempt < MAX_RETRIES) {\n        await delay(RETRY_DELAYS[attempt]);\n      }\n    }\n\n    // All retries exhausted\n    res.status(503).json({\n      success: false,\n      error: {\n        code: 'BACKEND_UNAVAILABLE',\n        message: 'Style service temporarily unavailable. Please try again or restart the service.'\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching styles:', error);\n    res.status(500).json({\n      success: false,\n      error: {\n        code: 'STYLES_ERROR',\n        message: error instanceof Error ? error.message : 'Failed to load styles'\n      }\n    });\n  }\n});\n\nrouter.post('/styles', async (req, res) => {\n  try {\n    const pythonHealthy = await checkPythonHealth();\n    if (!pythonHealthy) {\n      return res.status(503).json({\n        success: false,\n        error: 'Python backend is unavailable'\n      });\n    }\n\n    // Forward the raw multipart request stream to Python\n    const response = await fetch(`${PYTHON_API_URL}/styles`, {\n      method: 'POST',\n      headers: {\n        'content-type': req.headers['content-type'] as string,\n      },\n      body: Readable.toWeb(req) as ReadableStream,\n      duplex: 'half',\n    } as RequestInit);\n\n    const data = await response.json();\n    return res.status(response.status).json(data);\n  } catch (error: any) {\n    console.error('Error creating style:', error);\n    res.status(500).json({\n      success: false,\n      error: error.message || 'Failed to create style'\n    });\n  }\n});\n\nrouter.post('/styles/:styleId/images', async (req, res) => {\n  const { styleId } = req.params;\n  try {\n    const pythonHealthy = await checkPythonHealth();\n    if (!pythonHealthy) {\n      return res.status(503).json({\n        success: false,\n        error: 'Python backend is unavailable'\n      });\n    }\n\n    // Forward the raw multipart request stream to Python\n    const response = await fetch(`${PYTHON_API_URL}/styles/${styleId}/images`, {\n      method: 'POST',\n      headers: {\n        'content-type': req.headers['content-type'] as string,\n      },\n      body: Readable.toWeb(req) as ReadableStream,\n      duplex: 'half',\n    } as RequestInit);\n\n    const data = await response.json();\n    return res.status(response.status).json(data);\n  } catch (error: any) {\n    console.error(`Error adding images to style ${styleId}:`, error);\n    res.status(500).json({\n      success: false,\n      error: error.message || 'Failed to add images'\n    });\n  }\n});\n\nrouter.put('/styles/:styleId', async (req, res) => {\n  const { styleId } = req.params;\n  try {\n    const pythonHealthy = await checkPythonHealth();\n    if (!pythonHealthy) {\n      return res.status(503).json({\n        success: false,\n        error: 'Python backend is unavailable'\n      });\n    }\n\n    const response = await fetchFromPython<{ success: boolean; style: any }>(\n      `/styles/${styleId}`,\n      {\n        method: 'PUT',\n        body: JSON.stringify(req.body),\n      }\n    );\n    return res.json(response);\n  } catch (error: any) {\n    console.error(`Error updating style ${styleId}:`, error);\n    const status = error.message?.includes('404') ? 404 : 500;\n    res.status(status).json({\n      success: false,\n      error: error.message || 'Failed to update style'\n    });\n  }\n});\n\nrouter.delete('/styles/:styleId', async (req, res) => {\n  const { styleId } = req.params;\n  try {\n    const pythonHealthy = await checkPythonHealth();\n    if (!pythonHealthy) {\n      return res.status(503).json({\n        success: false,\n        error: 'Python backend is unavailable'\n      });\n    }\n\n    const response = await fetchFromPython<{ success: boolean; message: string }>(\n      `/styles/${styleId}`,\n      { method: 'DELETE' }\n    );\n    return res.json(response);\n  } catch (error: any) {\n    console.error(`Error deleting style ${styleId}:`, error);\n    const status = error.message?.includes('404') ? 404 : 500;\n    res.status(status).json({\n      success: false,\n      error: error.message || 'Failed to delete style'\n    });\n  }\n});\n\nrouter.delete('/styles/:styleId/images', async (req, res) => {\n  const { styleId } = req.params;\n  try {\n    const pythonHealthy = await checkPythonHealth();\n    if (!pythonHealthy) {\n      return res.status(503).json({\n        success: false,\n        error: 'Python backend is unavailable'\n      });\n    }\n\n    const response = await fetchFromPython<{ success: boolean; deleted: number; message: string }>(\n      `/styles/${styleId}/images`,\n      {\n        method: 'DELETE',\n        body: JSON.stringify(req.body),\n      }\n    );\n    return res.json(response);\n  } catch (error: any) {\n    console.error(`Error deleting images from style ${styleId}:`, error);\n    const status = error.message?.includes('404') ? 404 : 500;\n    res.status(status).json({\n      success: false,\n      error: error.message || 'Failed to delete images'\n    });\n  }\n});\n\nexport default router;\n", "// POST /api/feedback - Submit feedback\n// POST /api/feedback/summarize - Trigger feedback summarization\n\nimport { Router } from 'express';\nimport { fetchFromPython, checkPythonHealth } from '../services/python-client.js';\nimport type { FeedbackRequest, FeedbackResponse, SummarizeRequest, SummarizeResponse } from '../../../shared/schema/api-contracts.js';\n\nconst router = Router();\n\nrouter.post('/feedback', async (req, res) => {\n  try {\n    const { sessionId, styleId, feedback } = req.body as FeedbackRequest;\n\n    if (!sessionId || !styleId || !feedback) {\n      return res.status(400).json({\n        success: false,\n        error: {\n          code: 'INVALID_REQUEST',\n          message: 'Missing required fields: sessionId, styleId, and feedback are required'\n        }\n      });\n    }\n\n    const pythonHealthy = await checkPythonHealth();\n    if (!pythonHealthy) {\n      return res.status(503).json({\n        success: false,\n        error: {\n          code: 'BACKEND_UNAVAILABLE',\n          message: 'Python backend is unavailable'\n        }\n      });\n    }\n\n    const response = await fetchFromPython<FeedbackResponse>('/feedback', {\n      method: 'POST',\n      body: JSON.stringify({ sessionId, styleId, feedback })\n    });\n\n    return res.json(response);\n  } catch (error) {\n    console.error('Feedback error:', error);\n    res.status(500).json({\n      success: false,\n      error: {\n        code: 'FEEDBACK_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error'\n      }\n    });\n  }\n});\n\nrouter.post('/feedback/summarize', async (req, res) => {\n  try {\n    const { sessionId, styleId } = req.body as SummarizeRequest;\n\n    if (!sessionId || !styleId) {\n      return res.status(400).json({\n        success: false,\n        error: {\n          code: 'INVALID_REQUEST',\n          message: 'Missing required fields: sessionId and styleId are required'\n        }\n      });\n    }\n\n    const pythonHealthy = await checkPythonHealth();\n    if (!pythonHealthy) {\n      return res.status(503).json({\n        success: false,\n        error: {\n          code: 'BACKEND_UNAVAILABLE',\n          message: 'Python backend is unavailable'\n        }\n      });\n    }\n\n    const response = await fetchFromPython<SummarizeResponse>('/feedback/summarize', {\n      method: 'POST',\n      body: JSON.stringify({ sessionId, styleId })\n    });\n\n    return res.json(response);\n  } catch (error) {\n    console.error('Summarize error:', error);\n    res.status(500).json({\n      success: false,\n      error: {\n        code: 'SUMMARIZE_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error'\n      }\n    });\n  }\n});\n\nexport default router;\n", "// GET /api/generations - Return past generation history\n\nimport { Router } from 'express';\nimport { fetchFromPython, checkPythonHealth } from '../services/python-client.js';\n\nconst router = Router();\n\ninterface GenerationsResponse {\n  success: boolean;\n  total: number;\n  generations: Array<{\n    timestamp: string;\n    dirName: string;\n    userPrompt: string;\n    mode?: 'generate' | 'refine';\n    style: { id: string; name: string };\n    imageCount: number;\n    images: string[];\n  }>;\n}\n\nrouter.get('/generations', async (req, res) => {\n  try {\n    const pythonHealthy = await checkPythonHealth();\n\n    if (pythonHealthy) {\n      const queryString = new URLSearchParams(\n        req.query as Record<string, string>\n      ).toString();\n      const endpoint = queryString ? `/generations?${queryString}` : '/generations';\n      const response = await fetchFromPython<GenerationsResponse>(endpoint);\n      return res.json(response);\n    }\n\n    // Fallback: empty list when Python is unavailable\n    res.json({\n      success: true,\n      total: 0,\n      generations: [],\n    });\n  } catch (error) {\n    console.error('Error fetching generations:', error);\n    res.status(500).json({\n      success: false,\n      error: {\n        code: 'GENERATIONS_ERROR',\n        message: error instanceof Error ? error.message : 'Failed to fetch generations',\n      },\n    });\n  }\n});\n\nrouter.post('/generations/:dirName/confirm', async (req, res) => {\n  try {\n    const pythonHealthy = await checkPythonHealth();\n    if (!pythonHealthy) {\n      return res.status(503).json({ success: false, error: { code: 'BACKEND_UNAVAILABLE', message: 'Python backend is not available' } });\n    }\n\n    const response = await fetchFromPython<{ success: boolean }>(`/generations/${req.params.dirName}/confirm`, {\n      method: 'POST',\n    });\n    return res.json(response);\n  } catch (error) {\n    console.error('Error confirming generation:', error);\n    res.status(500).json({ success: false, error: { code: 'CONFIRM_ERROR', message: error instanceof Error ? error.message : 'Failed to confirm generation' } });\n  }\n});\n\nexport default router;\n"],
  "mappings": "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",
  "names": ["import_express", "import_express", "PYTHON_API_URL", "router", "MAX_RETRIES", "RETRY_DELAYS", "delay", "import_express", "router", "import_express", "router", "path", "express", "cors"]
}
